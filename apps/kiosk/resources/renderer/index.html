<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' kiosk:; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: kiosk:; font-src 'self' data:;">
  <title>Kiosk Shell</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: #e8e8e8;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .container {
      text-align: center;
      padding: 40px;
    }

    .logo {
      width: 120px;
      height: 120px;
      background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
      border-radius: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 30px;
      box-shadow: 0 10px 40px rgba(233, 69, 96, 0.3);
    }

    .logo svg {
      width: 60px;
      height: 60px;
      fill: white;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 600;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #fff 0%, #e8e8e8 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 1.1rem;
      color: #aaa;
      margin-bottom: 40px;
    }

    .info-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 24px 32px;
      margin-bottom: 30px;
      min-width: 300px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-label {
      color: #888;
    }

    .info-value {
      color: #e94560;
      font-weight: 500;
    }

    .status {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: rgba(46, 213, 115, 0.1);
      border: 1px solid rgba(46, 213, 115, 0.3);
      border-radius: 20px;
      color: #2ed573;
      font-size: 0.9rem;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: #2ed573;
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .footer {
      position: fixed;
      bottom: 20px;
      color: #666;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M20 3H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H4V5h16v10zm-2 5H6v2h12v-2z"/>
      </svg>
    </div>

    <h1>Kiosk Shell</h1>
    <p class="subtitle">Medical Self-Service Terminal</p>

    <div class="info-card">
      <div class="info-row">
        <span class="info-label">Device UUID</span>
        <span class="info-value" id="device-uuid">Loading...</span>
      </div>
      <div class="info-row">
        <span class="info-label">Platform</span>
        <span class="info-value" id="platform">Loading...</span>
      </div>
      <div class="info-row">
        <span class="info-label">Architecture</span>
        <span class="info-value" id="arch">Loading...</span>
      </div>
      <div class="info-row">
        <span class="info-label">Version</span>
        <span class="info-value" id="version">1.0.0</span>
      </div>
    </div>

    <div class="status">
      <span class="status-dot"></span>
      System Ready
    </div>

    <!-- Canvas Test Section -->
    <div class="info-card" style="margin-top: 20px;">
      <div class="info-row">
        <span class="info-label">Canvas Test</span>
        <span class="info-value" id="canvas-status">Testing...</span>
      </div>
      <div style="display: flex; gap: 20px; margin-top: 15px; justify-content: center;">
        <div>
          <canvas id="canvas-2d" width="100" height="100" style="border: 1px solid #444; border-radius: 8px;"></canvas>
          <p style="color: #888; font-size: 0.8rem; margin-top: 5px;">2D Canvas</p>
        </div>
        <div>
          <canvas id="canvas-webgl" width="100" height="100" style="border: 1px solid #444; border-radius: 8px;"></canvas>
          <p style="color: #888; font-size: 0.8rem; margin-top: 5px;">WebGL</p>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    Kiosk Shell &copy; 2024 - Secure Container for Medical Applications
  </div>

  <script>
    // Load device info via shellAPI (exposed by preload script)
    async function loadDeviceInfo() {
      try {
        if (window.shellAPI) {
          const deviceInfo = await window.shellAPI.getDeviceInfo();
          document.getElementById('device-uuid').textContent = deviceInfo.uuid || 'N/A';
          document.getElementById('platform').textContent = deviceInfo.platform || 'N/A';
          document.getElementById('arch').textContent = deviceInfo.arch || 'N/A';
          if (deviceInfo.version) {
            document.getElementById('version').textContent = deviceInfo.version;
          }
        } else {
          console.warn('shellAPI not available');
          document.getElementById('device-uuid').textContent = 'Unavailable';
          document.getElementById('platform').textContent = 'Unavailable';
          document.getElementById('arch').textContent = 'Unavailable';
        }
      } catch (error) {
        console.error('Failed to load device info:', error);
        document.getElementById('device-uuid').textContent = 'Error';
        document.getElementById('platform').textContent = 'Error';
        document.getElementById('arch').textContent = 'Error';
      }
    }

    // Test Canvas rendering
    function testCanvas() {
      const statusEl = document.getElementById('canvas-status');
      const results = [];

      // Test 2D Canvas
      try {
        const canvas2d = document.getElementById('canvas-2d');
        const ctx = canvas2d.getContext('2d');
        if (ctx) {
          // Draw gradient background
          const gradient = ctx.createLinearGradient(0, 0, 100, 100);
          gradient.addColorStop(0, '#e94560');
          gradient.addColorStop(1, '#ff6b6b');
          ctx.fillStyle = gradient;
          ctx.fillRect(0, 0, 100, 100);

          // Draw circle
          ctx.beginPath();
          ctx.arc(50, 50, 30, 0, Math.PI * 2);
          ctx.fillStyle = 'white';
          ctx.fill();

          results.push('2D: OK');
        } else {
          results.push('2D: Failed');
        }
      } catch (e) {
        results.push('2D: Error');
        console.error('2D Canvas error:', e);
      }

      // Test WebGL
      try {
        const canvasWebgl = document.getElementById('canvas-webgl');
        const gl = canvasWebgl.getContext('webgl') || canvasWebgl.getContext('experimental-webgl');
        if (gl) {
          // Set clear color to gradient-like colors
          gl.clearColor(0.91, 0.27, 0.38, 1.0); // #e94560
          gl.clear(gl.COLOR_BUFFER_BIT);

          results.push('WebGL: OK');
        } else {
          results.push('WebGL: Failed');
        }
      } catch (e) {
        results.push('WebGL: Error');
        console.error('WebGL error:', e);
      }

      statusEl.textContent = results.join(' | ');
      statusEl.style.color = results.every(r => r.includes('OK')) ? '#2ed573' : '#e94560';
    }

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      loadDeviceInfo();
      testCanvas();
    });
  </script>
</body>
</html>
